@using HomeManagement.Business.Catalog.ProductCategories;
@using HomeManagement.Business.Common.Interfaces;
@using HomeManagement.Core.Catalog;

@inject NavigationManager NavigationManager
@inject IDispacher Dispacher
@inject IDialogService DialogService

<section class="w-full p-3 fixed top-20 z-10 items-center mx-auto bg-gray-100/[.95]">
    <MyInputText Placeholder="ricerca..." @bind-Value=searchCategory />
</section>

<div class="pt-36 pb-16 px-3 flex flex-col space-y-2 z-0 items-center mx-auto">
    <section class="flex justify-center w-full rounded-2xl p-4 shadow-lg shadow-gray-900/5 max-w-sm bg-violet-700 text-slate-200" @onclick="()=>OnCategoryClick(null)">
        <h3 class="flex item-center text-sm font-bold">+</h3>
    </section>

    @foreach (ProductCategory item in FilteredCategoryItems)
    {
        <section class="flex justify-between w-full rounded-2xl p-4 shadow-lg shadow-gray-900/5 bg-white max-w-sm" @onclick="()=>OnCategoryClick(item)">
            <h3 class="flex item-center text-sm font-semibold text-gray-900">@item.Description</h3>
        </section>
    }
</div>

@code
{
    private string searchCategory;

    private IEnumerable<ProductCategory> CategoryItems;
    private IEnumerable<ProductCategory> FilteredCategoryItems => string.IsNullOrWhiteSpace(searchCategory) ? CategoryItems : CategoryItems.Where(c => c.Description.Contains(searchCategory, StringComparison.InvariantCultureIgnoreCase));

    protected override async Task OnInitializedAsync()
    {
        var readProductCategoryResult = await Dispacher.SendQuery(new ProductCategoryListQuery());
        if (readProductCategoryResult.Success)
        {
            CategoryItems = readProductCategoryResult.Content;
        }
        else
        {
            await DialogService.DisplayAlert("Errore lettura categorie", readProductCategoryResult.ErrorMessage, "Ok")
               .ConfigureAwait(false);
            CategoryItems = Enumerable.Empty<ProductCategory>();
        }
    }

    private void OnCategoryClick(ProductCategory selectedCategory)
    {
        if (selectedCategory != null)
        {
            NavigationManager.NavigateTo("productCategory/" + selectedCategory.Id);
        }
        else
        {
            NavigationManager.NavigateTo("productCategory");
        }
    }
}